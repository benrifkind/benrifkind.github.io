<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Fit Analysis</title>
    <meta name="description" content="Recent phD graduate in probability from the University of Toronto. Now trying to bridge the gap from academia to industry by learning statistics, data analysis, and R. This website will hosts writeups of the projects I'm working on.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://yourdomain.com/2014/10/30/Fit-Analysis.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Ben Rifkind</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Fit Analysis</h1>
    <p class="post-meta">Oct 30, 2014</p>
  </header>

  <article class="post-content">
    
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>randomForest<span class="p">)</span></code></pre></div>

<p>Read in the training and testing data</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">train <span class="o">=</span> read.csv<span class="p">(</span><span class="s">&quot;pml-training.csv&quot;</span><span class="p">,</span> stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
test <span class="o">=</span> read.csv<span class="p">(</span><span class="s">&quot;pml-testing.csv&quot;</span><span class="p">,</span> stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span></code></pre></div>

<p>I wrote a function to find the indices of the columns in the training data which have not
enough data. They need to have more than 406 entries which are not blank or NA.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#function to find index of columns with very little usable data</span>
<span class="c1">#from training data (blanks and NA&#39;s)</span>
bad.cols <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>dataframe<span class="p">,</span> threshold <span class="o">=</span> <span class="m">406</span><span class="p">){</span>
  
  <span class="c1">#count how many non NA&#39;s are in a column</span>
  count.non.nas <span class="o">=</span>  <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span>
    <span class="kp">sum</span><span class="p">(</span><span class="o">!</span><span class="kp">is.na</span><span class="p">(</span>x<span class="p">))</span> 
  <span class="p">}</span>
  <span class="c1">#find columns with too many na&#39;s</span>
  na.cols <span class="o">=</span> <span class="kp">apply</span><span class="p">(</span>dataframe<span class="p">,</span> MARGIN <span class="o">=</span> <span class="m">2</span><span class="p">,</span> count.non.nas<span class="p">)</span> <span class="o">&gt;</span> threshold
  na.cols <span class="o">=</span> <span class="kp">which</span><span class="p">(</span>na.cols <span class="o">==</span> <span class="bp">F</span><span class="p">)</span>
  
  <span class="c1">#count how many columns do not have blanks</span>
  count.non.blanks <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">){</span>
    <span class="kp">sum</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="kp">nchar</span><span class="p">(</span>x<span class="p">)</span> <span class="o">==</span> <span class="m">0</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="c1">#remove columns with too many blanks</span>
  blank.cols <span class="o">=</span> <span class="kp">apply</span><span class="p">(</span>dataframe<span class="p">,</span> MARGIN <span class="o">=</span> <span class="m">2</span><span class="p">,</span> count.non.blanks<span class="p">)</span> <span class="o">&gt;</span> threshold
  blank.cols <span class="o">=</span> <span class="kp">which</span><span class="p">(</span>blank.cols <span class="o">==</span> <span class="bp">F</span><span class="p">)</span>
  
  <span class="kr">return</span><span class="p">(</span><span class="kp">unique</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span>na.cols<span class="p">,</span> blank.cols<span class="p">)))</span>
<span class="p">}</span></code></pre></div>

<p>The indices of the unnecessary columns are </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">no.use.col <span class="o">=</span> bad.cols<span class="p">(</span>train<span class="p">)</span>
no.use.col <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">,</span> no.use.col<span class="p">)</span>
no.use.col</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##   [1]   1   2   3   4   5   6   7  18  19  21  22  24  25  27  28  29  30
##  [18]  31  32  33  34  35  36  50  51  52  53  54  55  56  57  58  59  75
##  [35]  76  77  78  79  80  81  82  83  93  94  96  97  99 100 103 104 105
##  [52] 106 107 108 109 110 111 112 131 132 134 135 137 138 141 142 143 144
##  [69] 145 146 147 148 149 150  12  13  14  15  16  17  20  23  26  69  70
##  [86]  71  72  73  74  87  88  89  90  91  92  95  98 101 125 126 127 128
## [103] 129 130 133 136 139</code></pre></div>

<p>Now I prepare the data by separating out the classification column and removing the unnecessary
columns. Since the classification column will not be used for analysis I remove it.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">train.class <span class="o">=</span> <span class="kp">as.factor</span><span class="p">(</span>train<span class="o">$</span>classe<span class="p">)</span>

train <span class="o">=</span> train<span class="p">[,</span> <span class="o">-</span>no.use.col<span class="p">]</span>
train<span class="o">$</span>classe <span class="o">=</span> <span class="kc">NULL</span>

test <span class="o">=</span> test<span class="p">[,</span> <span class="o">-</span>no.use.col<span class="p">]</span>
test<span class="o">$</span>problem_id <span class="o">=</span> <span class="kc">NULL</span></code></pre></div>

<p>I did everything by hand and didn’t use the caret package. Not the smartest way to do things. I am
using PCA to reduce dimensionality. First have to center and rescale the data. The centering and scaling comes from the training data. I use the same centering and rescaling for the test data.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#calculate mean and sds for each column of train</span>
means <span class="o">=</span> <span class="kp">colMeans</span><span class="p">(</span>train<span class="p">)</span>
sds <span class="o">=</span> <span class="kp">apply</span><span class="p">(</span>train<span class="p">,</span> <span class="m">2</span><span class="p">,</span> sd<span class="p">)</span>

<span class="c1">#center and rescale</span>
train <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span><span class="kp">t</span><span class="p">((</span><span class="kp">t</span><span class="p">(</span>train<span class="p">)</span> <span class="o">-</span> means<span class="p">)</span><span class="o">/</span>sds<span class="p">))</span>
test <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span><span class="kp">t</span><span class="p">((</span><span class="kp">t</span><span class="p">(</span>test<span class="p">)</span> <span class="o">-</span> means<span class="p">)</span><span class="o">/</span>sds<span class="p">))</span>

<span class="c1">#do PCA</span>
train.prcomp <span class="o">=</span> prcomp<span class="p">(</span>train<span class="p">,</span> center <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

<span class="c1">#predict using PCA</span>
train <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span>predict<span class="p">(</span>train.prcomp<span class="p">,</span> newdata <span class="o">=</span> train<span class="p">))</span>
test <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span>predict<span class="p">(</span>train.prcomp<span class="p">,</span> newdata <span class="o">=</span> test<span class="p">))</span></code></pre></div>

<p>I did some analysis to find how many PC’s were necessary by splitting the train data into training and validation data. This is probably not a good idea since I calculated means and sd’s for the full train set. Should have split the data up top. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">train.cut <span class="o">=</span> train<span class="p">[,</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">25</span><span class="p">)]</span> <span class="c1">#use only a few of PCA&#39;s</span>
train.cut<span class="o">$</span>classe <span class="o">=</span> train.class <span class="c1">#add back in classification column</span>

<span class="kp">set.seed</span><span class="p">(</span><span class="m">1224</span><span class="p">)</span>
fit <span class="o">=</span> randomForest<span class="p">(</span>classe<span class="o">~</span><span class="m">.</span><span class="p">,</span> data<span class="o">=</span>train.cut<span class="p">,</span>
               importance <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> ntree <span class="o">=</span> <span class="m">130</span><span class="p">)</span>
predictions <span class="o">=</span> predict<span class="p">(</span>fit<span class="p">,</span> newdata <span class="o">=</span> test<span class="p">)</span>
predictions</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 
##  B  A  B  A  A  E  D  B  A  A  B  C  B  A  E  E  A  B  B  B 
## Levels: A B C D E</code></pre></div>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Ben Rifkind</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Ben Rifkind</li>
          <li><a href="mailto:ben (dot) rifkind (at) gmail (dot) com">ben (dot) rifkind (at) gmail (dot) com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/benrifkind">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">benrifkind</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Recent phD graduate in probability from the University of Toronto. Now trying to bridge the gap from academia to industry by learning statistics, data analysis, and R. This website will hosts writeups of the projects I'm working on.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
